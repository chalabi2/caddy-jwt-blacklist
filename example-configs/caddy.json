{
  "admin": {
    "listen": "localhost:2019"
  },
  "logging": {
    "logs": {
      "default": {
        "writer": {
          "output": "stdout"
        },
        "encoder": {
          "format": "json"
        },
        "level": "INFO"
      }
    }
  },
  "apps": {
    "http": {
      "http_port": 80,
      "https_port": 443,
      "servers": {
        "srv0": {
          "listen": [":8080"],
          "routes": [
            {
              "match": [
                {
                  "host": ["localhost"]
                }
              ],
              "handle": [
                {
                  "handler": "subroute",
                  "routes": [
                    {
                      "handle": [
                        {
                          "handler": "jwt_blacklist",
                          "config": {
                            "redis_addr": "{env.REDIS_URL}",
                            "redis_password": "{env.REDIS_PASSWORD}",
                            "redis_db": 0,
                            "jwt_secret": "{env.JWT_SECRET}",
                            "blacklist_prefix": "BLACKLIST:key:",
                            "fail_open": true,
                            "timeout": "50ms",
                            "log_blocked": true,
                            "redis_tls": {
                              "enabled": true,
                              "min_version": "1.2"
                            }
                          }
                        }
                      ]
                    },
                    {
                      "match": [
                        {
                          "path": ["/health"]
                        }
                      ],
                      "handle": [
                        {
                          "handler": "static_response",
                          "body": "{\"status\":\"ok\",\"service\":\"jwt-blacklist\",\"timestamp\":\"{time.now.unix}\"}"
                        }
                      ]
                    },
                    {
                      "match": [
                        {
                          "path": ["/api/*"]
                        }
                      ],
                      "handle": [
                        {
                          "handler": "static_response",
                          "body": "{\"message\":\"API access granted\",\"path\":\"{uri}\",\"timestamp\":\"{time.now.unix}\"}"
                        }
                      ]
                    },
                    {
                      "handle": [
                        {
                          "handler": "static_response",
                          "body": "{\"message\":\"JWT Blacklist Test Server\",\"endpoints\":[\"/health\",\"/api/*\"]}"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ],
          "errors": {
            "routes": [
              {
                "match": [
                  {
                    "expression": "{http.error.status_code} == 401 && {http.error.message} contains \"blacklisted\""
                  }
                ],
                "handle": [
                  {
                    "handler": "static_response",
                    "status_code": 401,
                    "body": "{\"error\":\"api_key_blacklisted\",\"message\":\"API key has been disabled\",\"code\":401}"
                  }
                ]
              },
              {
                "handle": [
                  {
                    "handler": "static_response",
                    "body": "{\"error\":\"{http.error.status_code}\",\"message\":\"{http.error.status_text}\"}"
                  }
                ]
              }
            ]
          }
        }
      }
    }
  }
}
